---
name: "PR Tests"
"on":
  pull_request:
    branches:
    - "main"
  push:
    branches-ignore:
    - "main"
jobs:
  test:
    name: "Run Tests"
    runs-on: "ubuntu-latest"
    steps:
    - name: "Checkout code"
      uses: "actions/checkout@v4"
    - name: "Set up JDK 25"
      uses: "actions/setup-java@v4"
      with:
        java-version: "25"
        distribution: "temurin"
        cache: "maven"
    - name: "Run tests"
      run: "mvn clean test"
    - name: "Verify build"
      run: "mvn verify"
    - name: "Upload test results"
      if: "always()"
      uses: "actions/upload-artifact@v4"
      with:
        name: "test-results"
        path: "target/surefire-reports/"
        retention-days: 7
    - name: "Upload coverage reports"
      if: "always()"
      uses: "actions/upload-artifact@v4"
      with:
        name: "coverage-reports"
        path: "target/site/jacoco/"
        retention-days: 7
    - name: "Add coverage report comment"
      if: "github.event_name == 'pull_request'"
      uses: "madrapps/jacoco-report@v1.6.1"
      with:
        paths: "target/site/jacoco/jacoco.xml"
        token: "${{ secrets.GITHUB_TOKEN }}"
        min-coverage-overall: 60
        min-coverage-changed-files: 50
